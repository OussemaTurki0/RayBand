{"version":3,"names":["_react","require","_swr","_interopRequireDefault","_utils","obj","__esModule","default","getResponse","api","chatRequest","mutate","mutateStreamData","existingData","extraMetadataRef","messagesRef","abortControllerRef","onFinish","onResponse","sendExtraMessageFields","_chatRequest$options","_chatRequest$options2","previousMessages","current","messages","res","fetch","method","body","JSON","stringify","map","_ref","role","content","name","function_call","undefined","options","functions","credentials","headers","signal","catch","err","console","error","ok","Error","text","createdAt","Date","reader","json","streamedResponse","replyId","nanoid","responseMessage","id","data","cancel","startsWith","parsedFunctionCall","parse","useChat","initialMessages","initialInput","experimental_onFunctionCall","onError","arguments","length","hookId","useId","chatId","useSWR","fallbackData","isLoading","mutateLoading","streamData","useRef","useEffect","setError","useState","triggerRequest","useCallback","abortController","AbortController","messagesAndDataOrJustMessage","hasFollowingResponse","message","functionCall","functionCallResponse","streamedResponseMessage","append","concat","reload","lastMessage","slice","stop","abort","setMessages","input","setInput","handleSubmit","e","metadata","handleInputChange"],"sourceRoot":"../../src","sources":["use-chat.ts"],"mappings":"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"}