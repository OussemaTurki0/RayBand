{"version":3,"names":["useCallback","useEffect","useId","useRef","useState","useSWR","nanoid","getResponse","api","chatRequest","mutate","mutateStreamData","existingData","extraMetadataRef","messagesRef","abortControllerRef","onFinish","onResponse","sendExtraMessageFields","_chatRequest$options","_chatRequest$options2","previousMessages","current","messages","res","fetch","method","body","JSON","stringify","map","_ref","role","content","name","function_call","undefined","options","functions","credentials","headers","signal","catch","err","console","error","ok","Error","text","createdAt","Date","reader","json","streamedResponse","replyId","responseMessage","id","data","cancel","startsWith","parsedFunctionCall","parse","useChat","initialMessages","initialInput","experimental_onFunctionCall","onError","arguments","length","hookId","chatId","fallbackData","isLoading","mutateLoading","streamData","setError","triggerRequest","abortController","AbortController","messagesAndDataOrJustMessage","hasFollowingResponse","message","functionCall","functionCallResponse","streamedResponseMessage","append","concat","reload","lastMessage","slice","stop","abort","setMessages","input","setInput","handleSubmit","e","metadata","handleInputChange"],"sourceRoot":"../../src","sources":["use-chat.ts"],"mappings":"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"}