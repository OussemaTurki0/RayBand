{"dependencies":[{"name":"expo/virtual/env","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dgHc21cgR+buKc7O3/dChhD5JJk=","exportNames":["*"],"imports":1}},{"name":"expo-secure-store","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":49,"index":49}}],"key":"BU2XtfznZ4PiVldqd/oueHCCaLo=","exportNames":["*"],"imports":1}},{"name":"expo/fetch","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":50},"end":{"line":2,"column":48,"index":98}}],"key":"ug2WTu871fxhwUkT+lg+x8TWZJo=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopNamespace(e) {\n    if (e && e.__esModule) return e;\n    var n = {};\n    if (e) Object.keys(e).forEach(function (k) {\n      var d = Object.getOwnPropertyDescriptor(e, k);\n      Object.defineProperty(n, k, d.get ? d : {\n        enumerable: true,\n        get: function () {\n          return e[k];\n        }\n      });\n    });\n    n.default = e;\n    return n;\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  var _expoVirtualEnv = require(_dependencyMap[0], \"expo/virtual/env\");\n  var _expoSecureStore = require(_dependencyMap[1], \"expo-secure-store\");\n  var SecureStore = _interopNamespace(_expoSecureStore);\n  var _expoFetch = require(_dependencyMap[2], \"expo/fetch\");\n  const originalFetch = fetch;\n  const authKey = `${_expoVirtualEnv.env.EXPO_PUBLIC_PROJECT_GROUP_ID}-jwt`;\n  const getURLFromArgs = (...args) => {\n    const [urlArg] = args;\n    let url;\n    if (typeof urlArg === 'string') {\n      url = urlArg;\n    } else if (typeof urlArg === 'object' && urlArg !== null) {\n      url = urlArg.url;\n    } else {\n      url = null;\n    }\n    return url;\n  };\n  const isFirstPartyURL = url => {\n    return url.startsWith('/') || _expoVirtualEnv.env.EXPO_PUBLIC_BASE_URL && url.startsWith(_expoVirtualEnv.env.EXPO_PUBLIC_BASE_URL);\n  };\n  const isSecondPartyURL = url => {\n    return url.startsWith('/_create/');\n  };\n  const fetchToWeb = async function fetchWithHeaders(...args) {\n    const firstPartyURL = _expoVirtualEnv.env.EXPO_PUBLIC_BASE_URL;\n    const secondPartyURL = _expoVirtualEnv.env.EXPO_PUBLIC_PROXY_BASE_URL;\n    if (!firstPartyURL || !secondPartyURL) {\n      return (0, _expoFetch.fetch)(...args);\n    }\n    const [input, init] = args;\n    const url = getURLFromArgs(input, init);\n    if (!url) {\n      return (0, _expoFetch.fetch)(input, init);\n    }\n    const isExternalFetch = !isFirstPartyURL(url);\n    // we should not add headers to requests that don't go to our own server\n    if (isExternalFetch) {\n      return (0, _expoFetch.fetch)(input, init);\n    }\n    let finalInput = input;\n    const baseURL = isSecondPartyURL(url) ? secondPartyURL : firstPartyURL;\n    if (typeof input === 'string') {\n      finalInput = input.startsWith('/') ? `${baseURL}${input}` : input;\n    } else {\n      return originalFetch(input, init);\n    }\n    const initHeaders = init?.headers ?? {};\n    const finalHeaders = new Headers(initHeaders);\n    const headers = {\n      'x-createxyz-project-group-id': _expoVirtualEnv.env.EXPO_PUBLIC_PROJECT_GROUP_ID,\n      host: _expoVirtualEnv.env.EXPO_PUBLIC_HOST,\n      'x-forwarded-host': _expoVirtualEnv.env.EXPO_PUBLIC_HOST,\n      'x-createxyz-host': _expoVirtualEnv.env.EXPO_PUBLIC_HOST\n    };\n    for (const [key, value] of Object.entries(headers)) {\n      if (value) {\n        finalHeaders.set(key, value);\n      }\n    }\n    const auth = await SecureStore.getItemAsync(authKey).then(auth => {\n      return auth ? JSON.parse(auth) : null;\n    }).catch(() => {\n      return null;\n    });\n    if (auth) {\n      finalHeaders.set('authorization', `Bearer ${auth.jwt}`);\n    }\n    return (0, _expoFetch.fetch)(finalInput, {\n      ...init,\n      headers: finalHeaders\n    });\n  };\n  var _default = fetchToWeb;\n});","lineCount":102,"map":[[22,2,92,0,"Object"],[22,8,92,0],[22,9,92,0,"defineProperty"],[22,23,92,0],[22,24,92,0,"exports"],[22,31,92,0],[23,4,92,0,"enumerable"],[23,14,92,0],[24,4,92,0,"get"],[24,7,92,0],[24,18,92,0,"get"],[24,19,92,0],[25,6,92,0],[25,13,92,0,"_default"],[25,21,92,0],[26,4,92,0],[27,2,92,0],[28,2,92,26],[28,6,92,26,"_expoVirtualEnv"],[28,21,92,26],[28,24,92,26,"require"],[28,31,92,26],[28,32,92,26,"_dependencyMap"],[28,46,92,26],[29,2,1,0],[29,6,1,0,"_expoSecureStore"],[29,22,1,0],[29,25,1,0,"require"],[29,32,1,0],[29,33,1,0,"_dependencyMap"],[29,47,1,0],[30,2,1,0],[30,6,1,0,"SecureStore"],[30,17,1,0],[30,20,1,0,"_interopNamespace"],[30,37,1,0],[30,38,1,0,"_expoSecureStore"],[30,54,1,0],[31,2,2,0],[31,6,2,0,"_expoFetch"],[31,16,2,0],[31,19,2,0,"require"],[31,26,2,0],[31,27,2,0,"_dependencyMap"],[31,41,2,0],[32,2,4,0],[32,8,4,6,"originalFetch"],[32,21,4,19],[32,24,4,22,"fetch"],[32,29,4,27],[33,2,5,0],[33,8,5,6,"authKey"],[33,15,5,13],[33,18,5,16],[33,21,5,16,"_expoVirtualEnv"],[33,36,5,16],[33,37,5,16,"env"],[33,40,5,16],[33,41,5,16,"EXPO_PUBLIC_PROJECT_GROUP_ID"],[33,69,5,16],[33,75,5,65],[34,2,7,0],[34,8,7,6,"getURLFromArgs"],[34,22,7,20],[34,25,7,23,"getURLFromArgs"],[34,26,7,24],[34,29,7,27,"args"],[34,33,7,57],[34,38,7,62],[35,4,8,2],[35,10,8,8],[35,11,8,9,"urlArg"],[35,17,8,15],[35,18,8,16],[35,21,8,19,"args"],[35,25,8,23],[36,4,9,2],[36,8,9,6,"url"],[36,11,9,24],[37,4,10,2],[37,8,10,6],[37,15,10,13,"urlArg"],[37,21,10,19],[37,26,10,24],[37,34,10,32],[37,36,10,34],[38,6,11,4,"url"],[38,9,11,7],[38,12,11,10,"urlArg"],[38,18,11,16],[39,4,12,2],[39,5,12,3],[39,11,12,9],[39,15,12,13],[39,22,12,20,"urlArg"],[39,28,12,26],[39,33,12,31],[39,41,12,39],[39,45,12,43,"urlArg"],[39,51,12,49],[39,56,12,54],[39,60,12,58],[39,62,12,60],[40,6,13,4,"url"],[40,9,13,7],[40,12,13,10,"urlArg"],[40,18,13,16],[40,19,13,17,"url"],[40,22,13,20],[41,4,14,2],[41,5,14,3],[41,11,14,9],[42,6,15,4,"url"],[42,9,15,7],[42,12,15,10],[42,16,15,14],[43,4,16,2],[44,4,17,2],[44,11,17,9,"url"],[44,14,17,12],[45,2,18,0],[45,3,18,1],[46,2,20,0],[46,8,20,6,"isFirstPartyURL"],[46,23,20,21],[46,26,20,25,"url"],[46,29,20,36],[46,33,20,41],[47,4,21,2],[47,11,22,4,"url"],[47,14,22,7],[47,15,22,8,"startsWith"],[47,25,22,18],[47,26,22,19],[47,29,22,22],[47,30,22,23],[47,34,23,5,"_expoVirtualEnv"],[47,49,23,5],[47,50,23,5,"env"],[47,53,23,5],[47,54,23,5,"EXPO_PUBLIC_BASE_URL"],[47,74,23,5],[47,78,23,41,"url"],[47,81,23,44],[47,82,23,45,"startsWith"],[47,92,23,55],[47,93,23,55,"_expoVirtualEnv"],[47,108,23,55],[47,109,23,55,"env"],[47,112,23,55],[47,113,23,55,"EXPO_PUBLIC_BASE_URL"],[47,133,23,88],[47,134,23,90],[48,2,25,0],[48,3,25,1],[49,2,27,0],[49,8,27,6,"isSecondPartyURL"],[49,24,27,22],[49,27,27,26,"url"],[49,30,27,37],[49,34,27,42],[50,4,28,2],[50,11,28,9,"url"],[50,14,28,12],[50,15,28,13,"startsWith"],[50,25,28,23],[50,26,28,24],[50,37,28,35],[50,38,28,36],[51,2,29,0],[51,3,29,1],[52,2,32,0],[52,8,32,6,"fetchToWeb"],[52,18,32,16],[52,21,32,19],[52,36,32,34,"fetchWithHeaders"],[52,52,32,50,"fetchWithHeaders"],[52,53,32,51],[52,56,32,54,"args"],[52,60,32,66],[52,62,32,68],[53,4,33,2],[53,10,33,8,"firstPartyURL"],[53,23,33,21],[53,26,33,21,"_expoVirtualEnv"],[53,41,33,21],[53,42,33,21,"env"],[53,45,33,21],[53,46,33,21,"EXPO_PUBLIC_BASE_URL"],[53,66,33,56],[54,4,34,2],[54,10,34,8,"secondPartyURL"],[54,24,34,22],[54,27,34,22,"_expoVirtualEnv"],[54,42,34,22],[54,43,34,22,"env"],[54,46,34,22],[54,47,34,22,"EXPO_PUBLIC_PROXY_BASE_URL"],[54,73,34,63],[55,4,35,2],[55,8,35,6],[55,9,35,7,"firstPartyURL"],[55,22,35,20],[55,26,35,24],[55,27,35,25,"secondPartyURL"],[55,41,35,39],[55,43,35,41],[56,6,36,4],[56,13,36,11],[56,17,36,11,"expoFetch"],[56,27,36,20],[56,28,36,20,"fetch"],[56,33,36,20],[56,35,36,21],[56,38,36,24,"args"],[56,42,36,28],[56,43,36,29],[57,4,37,2],[58,4,38,2],[58,10,38,8],[58,11,38,9,"input"],[58,16,38,14],[58,18,38,16,"init"],[58,22,38,20],[58,23,38,21],[58,26,38,24,"args"],[58,30,38,28],[59,4,39,2],[59,10,39,8,"url"],[59,13,39,11],[59,16,39,14,"getURLFromArgs"],[59,30,39,28],[59,31,39,29,"input"],[59,36,39,34],[59,38,39,36,"init"],[59,42,39,40],[59,43,39,41],[60,4,40,2],[60,8,40,6],[60,9,40,7,"url"],[60,12,40,10],[60,14,40,12],[61,6,41,4],[61,13,41,11],[61,17,41,11,"expoFetch"],[61,27,41,20],[61,28,41,20,"fetch"],[61,33,41,20],[61,35,41,21,"input"],[61,40,41,26],[61,42,41,28,"init"],[61,46,41,32],[61,47,41,33],[62,4,42,2],[63,4,44,2],[63,10,44,8,"isExternalFetch"],[63,25,44,23],[63,28,44,26],[63,29,44,27,"isFirstPartyURL"],[63,44,44,42],[63,45,44,43,"url"],[63,48,44,46],[63,49,44,47],[64,4,45,2],[65,4,46,2],[65,8,46,6,"isExternalFetch"],[65,23,46,21],[65,25,46,23],[66,6,47,4],[66,13,47,11],[66,17,47,11,"expoFetch"],[66,27,47,20],[66,28,47,20,"fetch"],[66,33,47,20],[66,35,47,21,"input"],[66,40,47,26],[66,42,47,28,"init"],[66,46,47,32],[66,47,47,33],[67,4,48,2],[68,4,50,2],[68,8,50,6,"finalInput"],[68,18,50,16],[68,21,50,19,"input"],[68,26,50,24],[69,4,51,2],[69,10,51,8,"baseURL"],[69,17,51,15],[69,20,51,18,"isSecondPartyURL"],[69,36,51,34],[69,37,51,35,"url"],[69,40,51,38],[69,41,51,39],[69,44,51,42,"secondPartyURL"],[69,58,51,56],[69,61,51,59,"firstPartyURL"],[69,74,51,72],[70,4,52,2],[70,8,52,6],[70,15,52,13,"input"],[70,20,52,18],[70,25,52,23],[70,33,52,31],[70,35,52,33],[71,6,53,4,"finalInput"],[71,16,53,14],[71,19,53,17,"input"],[71,24,53,22],[71,25,53,23,"startsWith"],[71,35,53,33],[71,36,53,34],[71,39,53,37],[71,40,53,38],[71,43,53,41],[71,46,53,44,"baseURL"],[71,53,53,51],[71,56,53,54,"input"],[71,61,53,59],[71,63,53,61],[71,66,53,64,"input"],[71,71,53,69],[72,4,54,2],[72,5,54,3],[72,11,54,9],[73,6,55,4],[73,13,55,11,"originalFetch"],[73,26,55,24],[73,27,55,25,"input"],[73,32,55,30],[73,34,55,32,"init"],[73,38,55,36],[73,39,55,37],[74,4,56,2],[75,4,58,2],[75,10,58,8,"initHeaders"],[75,21,58,19],[75,24,58,22,"init"],[75,28,58,26],[75,30,58,28,"headers"],[75,37,58,35],[75,41,58,39],[75,42,58,40],[75,43,58,41],[76,4,59,2],[76,10,59,8,"finalHeaders"],[76,22,59,20],[76,25,59,23],[76,29,59,27,"Headers"],[76,36,59,34],[76,37,59,35,"initHeaders"],[76,48,59,46],[76,49,59,47],[77,4,61,2],[77,10,61,8,"headers"],[77,17,61,15],[77,20,61,18],[78,6,62,4],[78,36,62,34],[78,38,62,34,"_expoVirtualEnv"],[78,53,62,34],[78,54,62,34,"env"],[78,57,62,34],[78,58,62,34,"EXPO_PUBLIC_PROJECT_GROUP_ID"],[78,86,62,76],[79,6,63,4,"host"],[79,10,63,8],[79,12,63,8,"_expoVirtualEnv"],[79,27,63,8],[79,28,63,8,"env"],[79,31,63,8],[79,32,63,8,"EXPO_PUBLIC_HOST"],[79,48,63,38],[80,6,64,4],[80,24,64,22],[80,26,64,22,"_expoVirtualEnv"],[80,41,64,22],[80,42,64,22,"env"],[80,45,64,22],[80,46,64,22,"EXPO_PUBLIC_HOST"],[80,62,64,52],[81,6,65,4],[81,24,65,22],[81,26,65,22,"_expoVirtualEnv"],[81,41,65,22],[81,42,65,22,"env"],[81,45,65,22],[81,46,65,22,"EXPO_PUBLIC_HOST"],[82,4,66,2],[82,5,66,3],[83,4,68,2],[83,9,68,7],[83,15,68,13],[83,16,68,14,"key"],[83,19,68,17],[83,21,68,19,"value"],[83,26,68,24],[83,27,68,25],[83,31,68,29,"Object"],[83,37,68,35],[83,38,68,36,"entries"],[83,45,68,43],[83,46,68,44,"headers"],[83,53,68,51],[83,54,68,52],[83,56,68,54],[84,6,69,4],[84,10,69,8,"value"],[84,15,69,13],[84,17,69,15],[85,8,70,6,"finalHeaders"],[85,20,70,18],[85,21,70,19,"set"],[85,24,70,22],[85,25,70,23,"key"],[85,28,70,26],[85,30,70,28,"value"],[85,35,70,33],[85,36,70,34],[86,6,71,4],[87,4,72,2],[88,4,74,2],[88,10,74,8,"auth"],[88,14,74,12],[88,17,74,15],[88,23,74,21,"SecureStore"],[88,34,74,32],[88,35,74,33,"getItemAsync"],[88,47,74,45],[88,48,74,46,"authKey"],[88,55,74,53],[88,56,74,54],[88,57,75,5,"then"],[88,61,75,9],[88,62,75,11,"auth"],[88,66,75,15],[88,70,75,20],[89,6,76,6],[89,13,76,13,"auth"],[89,17,76,17],[89,20,76,20,"JSON"],[89,24,76,24],[89,25,76,25,"parse"],[89,30,76,30],[89,31,76,31,"auth"],[89,35,76,35],[89,36,76,36],[89,39,76,39],[89,43,76,43],[90,4,77,4],[90,5,77,5],[90,6,77,6],[90,7,78,5,"catch"],[90,12,78,10],[90,13,78,11],[90,19,78,17],[91,6,79,6],[91,13,79,13],[91,17,79,17],[92,4,80,4],[92,5,80,5],[92,6,80,6],[93,4,82,2],[93,8,82,6,"auth"],[93,12,82,10],[93,14,82,12],[94,6,83,4,"finalHeaders"],[94,18,83,16],[94,19,83,17,"set"],[94,22,83,20],[94,23,83,21],[94,38,83,36],[94,40,83,38],[94,50,83,48,"auth"],[94,54,83,52],[94,55,83,53,"jwt"],[94,58,83,56],[94,60,83,58],[94,61,83,59],[95,4,84,2],[96,4,86,2],[96,11,86,9],[96,15,86,9,"expoFetch"],[96,25,86,18],[96,26,86,18,"fetch"],[96,31,86,18],[96,33,86,19,"finalInput"],[96,43,86,29],[96,45,86,31],[97,6,87,4],[97,9,87,7,"init"],[97,13,87,11],[98,6,88,4,"headers"],[98,13,88,11],[98,15,88,13,"finalHeaders"],[99,4,89,2],[99,5,89,3],[99,6,89,4],[100,2,90,0],[100,3,90,1],[101,2,92,0],[101,6,92,0,"_default"],[101,14,92,0],[101,17,92,15,"fetchToWeb"],[101,27,92,25],[102,0,92,26],[102,3]],"functionMap":{"names":["<global>","getURLFromArgs","isFirstPartyURL","isSecondPartyURL","fetchWithHeaders","SecureStore.getItemAsync.then$argument_0","SecureStore.getItemAsync.then._catch$argument_0"],"mappings":"AAA;uBCM;CDW;wBEE;CFK;yBGE;CHE;mBIG;UC2C;KDE;WEC;KFE;CJU"},"hasCjsExports":false},"type":"js/module"}]}